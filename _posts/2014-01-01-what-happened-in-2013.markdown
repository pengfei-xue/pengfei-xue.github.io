---
layout: post
title: 'what happened in 2013'
date: 2014-01-01
author: Pengfei.X
version: 0.1
categories: [others, ]
excerpt: 2013年小结
---

微博上好多年终小结，我觉得也应该写一下，毕竟是工作迈入第三个年头，之前看过一片文章，
大致是说工作第三年是关键的一年，之后的发展跟这一年有很大的关系。在实际工作以及生活
中，也许是那篇文章潜移默化的影响，越发觉得说的很对，需要对自己做个总结和反思。


## 工作 ##
    

这一年做了几个大小项目，有Web类应用，也有运维相关的，做个小总结吧。
   

### OupengSync

先说说工作吧，2013年年初就在做OupengSync项目，也就是现在的欧朋云同步，主要的功能是
将手机端的书签，输入历史等同步到服务器，同时可以支持多台设备之间的同步。看目前的代码
量其实不多，有4554行，不太清楚这个代码量算不算多，相比目前其它几个项目，它是最多的。

年初的最初版本是基于Opera的同步代码，参考着做。数据存储用的是Riak，协议部分也是参考
着做。但是，过了很一段时间后，才发现当时所参考的版本基本上是不能运行的，代码里面有很多bug，
也没有一个可测试的客户端在手里，所以，能做的工作不多。加上受到同事的影响，说是代码直
接可以用，几乎不用修改，有点麻痹了。

Riak是Erlang开发的一个Nosql存储，虽然扩展性很好，但是，维护成本比较大，心里没底。
当然也可以购买商业支持，但最终这个方案还是被放弃后，开始着手研究Mongodb。由于存储
层和业务层划分的比较好，耦合性低，所以，很快这个方案就搞定了。一直到现在，我们还在
用Mongodb，部署模式为Replicaset，自己做Sharding。

Mongodb本地支持自动分片，但是，测试下来的结果不太理想，特别是做Balance的时候，整个集群
的吞吐几乎降低为零，这个是无法接受的。于是，直接抛弃了这个方案，改用自己做Sharding，按照
用户的UID来划分。最初是用一个集群，多个数据库的方式做Sharding，而后来的压力测试发现了一个
问题，就是在多个Replicaset同步的时候，锁非常严重，吞吐不高，查看Mongodb的日志，才知道虽然
多个数据库的部署方式可以减缓锁的压力，但是，有一个数据的锁非常严重，就是local，Mongodb中，
这个数据用来维护一个操作日志等，当写压力上升后，对local的压力非常大，最终的结果就是，每个
数据库的锁减缓了，但是local的锁竞争变的不可接受。最终的解决办法是，部署多集群加多数据的模式，
目前压力比较小，可以抗下来，之后还是要再继续优化。

整个项目的进度非常缓慢，而且是做一段时间，然后就被暂停下来做其它的事情，或者是项目的资源被
抽调去干其它的事情。磨来磨去，直到10份左右才上线，让人揪心。技术方面遇到的问题包括多个设备
之间同步，保证数据不丢失，数据的位置信息保持正确等。不做不知道，做了才发现有很多的难点，特别
是处理同步同个设备时，涉及到的合并的问题。用了好几个模型，争议了好久才最终确定，而从确定方案
到最终完成只花了不到一周的时间，现在想想，我自己都觉得有些不可思议，效率太高了。做完之后最多的
时间就是等待资源，虽然项目在多个场合被认为是很重要的，但是，实际的情况完全相反。整个过程对我
来说就是煎熬，像个产妇在手术台上待产，然后一会儿手术室电没了，一会儿医生晕过去了，着急啊。

   
### 运维

除了开发，还兼了一部分的运维工作，知道今年四五月份之后，才将服务器维护相关的工作移交出去，目前
还承担一些项目上线的任务。没交出去之前，工作时间被打断成无数个片段，一会儿有同事申请虚拟机，一会儿
线上机器挂了要处理，一会儿又是项目要上线等等，很头疼。上线对我来说就是噩梦，一开是上线是纯体力活，
方法原始到极点，基本就是tar打包，然后scp到服务器，一台一台去更新代码。还好有iterm2，可以多个terminal
一起输入，否则，肯定已经被坑杀了。重复的工作做多了，就开始想偷懒，于是，开发了一个到包发布的工具，
可以把项目打包成RPM，然后使用fabric来做更新升级。现在很多项目都开始用这个工具，有掉小成就感，:-)。

目前这个工具有个问题，就是配置文件和代码耦合的太厉害，而且隐藏在目录结构的较低层次，配置文件目前按照
项目组分开了，每个项目组的配置文件已经超过一页了，容易出现配置错误，需要继续优化一下，也许用YAML吧。

当然，也考虑使用puppet来管理线上线下的环境，但是，推动了一段时间后发现有点难度，缺乏动力，也就
作罢了。研究puppet的成果也有一些，开发了几个配置，可以管理php环境，安装nginx，keepalived等。

以上这两个项目也让我更加认识到自己的一个确定，就是对一件事情缺乏主动推进的动力(HR, 可能是那个啥不到位)，
大环境对项目没有支持的时候，就开始怠慢。这个问题需要改正一下，希望可以在2014年做到吧。


### 代码阅读

空间之余开始读一些开源代码，主要是Flask框架，我有几个项目都选了它来开发，不喜欢Django，感觉太复杂了。
Flask的代码确实很优秀，代码风格一流，注释丰富。比较自己写的，感觉自己的代码太难看了，简直无法直视。

阅读代码可以更好地使用这个框架，在对应用做单元测试的时候，有的时候需要对代码做一个hack，否则，无法
继续进行下去。如果不了解使用的框架，遇到这个情况，可能就会束手无测了。

另外一个阅读的多一些的项目是Beego，一个Golang的web框架。另外，贡献了一些代码，不多，但是目前在top5里面的。
阅读代码给我带来的影响很好，我觉得接下来还会继续，坚持每天都去Github上贡献一些自己的力量。

    
### Golang

还有其它几个Python的项目，比较类似，所以不写了，还是写写学的新语言吧。刚开始接触Golang
被它的性能震惊了，有动态语言的有点，开发速度快，效率高。同时具备静态语言的效率。而且语言
本身提供了很多高并发的支持，对于目前我们遇到的问题，很有帮助。
    

## 生活


2013年是我真的本命年，发生好多起事故，被盗多次。2013年也发生很多让我难忘的事情，
去泰国碰到了6个朋友，并且一起又去了其它地方旅行，保持着很好的关系，很珍惜这段友情，
希望可以一直继续下去。


### 旅行

2013年和宝贝一起去了泰国和云南。在泰国玩的很高兴，第一次出国，体验了真正的3G，看
到了泰囧里的美女人妖，在沙美岛海底漫步，太爽了。

以为到了泰国手机就是摆设了，经过同行导游的指点，去了711买了3G电话卡，资费超级便宜，
上网速度贼快，这才是真正的3G啊。在泰国遍地都是711，大马路上几乎全市皮卡，主要是
日本的本田和丰田，听当地导游介绍，中国在泰国的影响比日本大，可实际观察到的，却有些
出入。最直接的就是我们可以直接接触的日常生活用品，便利店等。去大皇宫的时候，导游
介绍说泰国的土地是私有的，太让人羡慕了，后来晚上出去玩，看到商品房的价格，相对来讲
，比国内便宜，而且是在曼谷。泰国是个热带国家，多虫，雨季时间长，市区的很多建筑底下
几层都是空出来当停车场，或者是种了很多植物，有点像新加坡，看着特别新鲜。

在沙美岛上待了差不多两天，沙滩特别好，沙子很细，海水特别蓝，虽然没去过海南，直觉
告诉我，这里比海南要好N倍。在沙美岛住的是小别墅，上下两层的，我们住的是楼下，整体
感觉不错，有点情调。玩的比较刺激的是，海底漫游。带着类似太空帽的空气罩，在海底喂鱼。
导游给我们分了一些面包，在海底抓在手里，有很多小鱼游过来，吃面包，像是童话世界一样。
临下海的时候，有好多女孩不敢下去，从船上看起来有点恐怖，供氧设备很粗糙。在海底有些
站不住，害怕自己一脚踩空，然后，唔呼唉哉了。

然后去了巴提亚，结识了现在的6位朋友，一起去看了三合表演（色情表演吧），回到酒店了，
我们几个又去了当地的一个小酒吧，打打台球，喝了好多酒，我喝醉了。

最后回到曼谷，看了人妖表演，见到了泰囧里面的人妖，果然很美。其它的人妖远处看和女人
很像，但是，走近了要拍照就有些恐怖了，可以最直接、最直观地感受到她们是男人，有些
毛骨悚然。

后来，端午我们几个又一起去了云南。开始是准备和另外一朋友一起求婚的，但是，中间出了
一些小插曲，我没求，那朋友求了。被感动了，我差点哭了。

去云南我们是从北京飞昆明，到昆明的时候已经是夜里了，去香格里拉的飞机是早晨的，具体
几点的航班，现在已经记不清楚了，在昆明机场待了一宿，我没有睡。飞香格里拉的时候经过
群山，山的高度很飞行高度差不多，感觉飞机是在山谷里面飞的。一眼望去，满眼的绿色，生机
无限。

在香格里拉，吃了耳丝，米线，松荣，在古城里面转超级大的经塔。我们一起去了松赞林寺(
好像是这个名字)，那帕海(貌似这个名字)，在那帕海拍了很多照片，朋友的求婚也是在这里，
风景特别美，现在还可以记得每一个画面。限于篇幅，不大算详细地写了。

之后又去了大理，丽江。在丽江，熊哥碰到老乡，给我我们带了唱片<一瞬间>。在大理我们
一起按摩，吃了当地的美食。后来去喝茶的时候，熊哥觉得杯子不错，回来后，给我们找到
同样的杯子，每人送了一个。在大理，我们租了自行车，晚上绕着洱海骑了一会儿，一切烦恼
都不见了。在苍山坐了亚洲最大的缆车，喔，赞。


其实吧，我也准备求婚来着，一起去买了钻石戒指，不过期间吵架了，而且很凶，也就作罢了。
吵架的时候，我不够风度，有的时候还会不理女朋友，直接自己走掉，把她丢在大马路上。其实，
也知道那样做不对，可是，当时我自己感觉都要爆炸了，有点失去理智的那种。这一点是我做
的不对的地方，也希望宝贝可以原谅我，2014自己要尽最大可能去改掉这个坏习惯。2014也是
我们准备结婚的一年，2月份准备求婚，得好好想想。

写了这么长，估计看到这里的观众也少了，呵呵。宝贝，嫁给我吧。


### 事故

还是先写事故吧，去云南之前的一个礼拜被盗了一台Macbook Pro，一台iPhone。在北京漂，
房租太贵，和其它几个人一起合租。被盗那天有个姐妹出门没有锁门，结果被溜门了，被盗
一台Macbook Pro。当时我还在睡觉，醒来发现电脑没了，开始还以为是同屋的开玩笑，打电话
问才知道是被盗了。第一次碰到这样的事情，想想都后怕，万一进来是偷肾的，我岂不是拜拜
了。伤心了好久，安慰自己是破财消灾吧。重新买了一台Macbook Air，并且晚上睡觉的时候
放在枕头边上，非常害怕又被偷了。以为这事情就过去了，结果过了不到一个礼拜，晚上回来
的路上手机被人抢了。真想骂街，听着歌，手机放在裤子的侧兜里，结果被拽了。

那小偷回想起来应该是个惯犯，速度很快，我感觉到裤兜被拽，然后马上回头，小偷都不见了。
四处找了都没有发现。离去云南还有一天，这个坎让我灰心了很久，感觉自己被诅咒了一样。
有点提不起精神，如果不是去云南，很可能会消沉两三个礼拜。这两次都报警了，警察很负责，
做了笔录，还有回访。但是，之后就没有消息了，至今也没有消息。

放生了这两件事情，被女友说了很久。我自己也觉得无地自容，毕竟连着发生这样的事情，
让自己觉得很蠢。重来没发现自己周围的治安环境是如此差，女友说我太傻，太天真，太粗心，
太拿钱不当钱。我觉得说的蛮对。好吧，之后去了云南，算是去散心了。

以为这两件事情就是2013年倒霉的收尾之作了，没想到的是，之后还有。买Air不到两个月，
硬盘坏了，资料全部丢失，唯一值得安慰的是，换硬盘不用钱，免费的。然后，再过了不到
三个月，国庆去唐山参加婚礼，结果回来的路上，Air被盗。我去，我死的心都有了，恨不得
当时就把全世界的小偷全抓起来，爆打一顿。去唐山之前，女友就说不要带电脑，可是，我还是
带了，有篇文章要写。结果不听劝，最终被盗。从唐山回来，快到北京的时候，书包放在一直
放在腿上，后来实在觉得难受，腿脚伸不开，于是就把书包放在了行李架上。经过之前两件事情，
自己当然也留了个心眼，不时地抬头看看书包是不是被盗之类。

一直到下车都没有发现被盗，直到下车了，同行的一个朋友告诉我，有人翻我书包了，我去你
大爷，你这个时候才告诉我，还不如不告诉我啊。赶紧把书包打开看了一下，结果Air被盗。
当时，我有体会到大脑发晕，不知所措了。什么情况，怎么这样的事情又发生了，而且，是在
我一直留着心眼，注意着自己的书包的情况下发生了。我开始怀疑自己是不是脑子有问题，一
而再，再而三地丢东西，肯定是自己有问题了。女朋友也着急地哭了，她一直在责备自己，说
她也没察觉到。看着她哭，我也点崩溃，很想抱着她一起哭，但是，自己还是忍住了，一直安
慰她。宝贝，真对不起你。

等自己平静了，才慢慢想起，在车上有个人推了自己的书包，我当时以为是那人害怕放在行李
架的东西掉下来，结果是小偷，坑爹，自己太幼稚，太天真了。如果第一时间感觉有问题就去
检查一下，就不会发生这样的事情。从此之后，乘坐公共交通，都把书包背在前面，不能在丢
东西了。

(2011年的时候，从南京坐了一夜火车回北京，结果感冒了，第二天搬家，把电脑忘在了出租车上)
